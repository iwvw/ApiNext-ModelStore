"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("react/jsx-runtime"),i=require("react"),c=require("lucide-react"),{Button:o}=require("@/components/ui/button"),{Input:R}=require("@/components/ui/input"),{Card:w,CardHeader:q,CardTitle:P,CardContent:k,CardDescription:L}=require("@/components/ui/card"),{Badge:C}=require("@/components/ui/badge"),{Table:S,TableHeader:T,TableBody:A,TableHead:f,TableRow:b,TableCell:m}=require("@/components/ui/table"),y=({title:n,value:t,sub:d,icon:x,color:h="text-primary"})=>x?e.jsx(w,{className:"flex items-center gap-4",children:e.jsxs(k,{className:"p-4 flex items-center gap-4 w-full",children:[e.jsx("div",{className:`p-3 rounded-lg bg-muted ${h}`,children:e.jsx(x,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:n}),e.jsx("h3",{className:"text-2xl font-bold",children:t}),d&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d})]})]})}):null,z=({logs:n})=>e.jsxs(w,{className:"flex flex-col h-full overflow-hidden border-zinc-800",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-zinc-800 bg-zinc-900/50",children:[e.jsxs("span",{className:"font-semibold flex items-center gap-2",children:[e.jsx(c.Terminal,{className:"w-4 h-4"})," 实时日志"]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:[n.length," events"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:[n.map(t=>e.jsxs("div",{className:"group flex gap-3 hover:bg-zinc-900/50 p-1 -mx-1 rounded",children:[e.jsx("span",{className:"text-zinc-600 shrink-0",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${t.status===200?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:t.status===200?"OK":"ERR"}),e.jsx("span",{className:"text-zinc-400",children:t.model}),e.jsxs("span",{className:"text-zinc-500 text-xs",children:["via ",t.account]})]}),t.has_thinking&&e.jsxs("div",{className:"text-purple-400 text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-3 bg-purple-500 rounded-full inline-block"}),"捕捉到思考过程"]}),t.error&&e.jsx("div",{className:"text-red-400 break-all",children:t.error})]}),e.jsxs("span",{className:"text-zinc-500 shrink-0",children:[t.duration,"ms"]})]},t.id)),n.length===0&&e.jsx("div",{className:"text-zinc-600 text-center py-10 italic",children:"等待请求中..."})]})]}),_=({accounts:n,onUpdate:t,onRefresh:d})=>{const[x,h]=i.useState(""),[p,u]=i.useState(!1),g=i.useRef(null),r={total:n.length,active:n.filter(s=>s.is_active).length,errors:n.reduce((s,a)=>s+(a.error_count||0),0)},j=()=>{try{const s=JSON.parse(x);let a=s;!Array.isArray(s)&&s.accounts&&Array.isArray(s.accounts)&&(a=s.accounts),Array.isArray(a)?(t(a),u(!1),h("")):alert("格式错误：必须是账号数组，或包含 accounts 数组的对象。")}catch{alert("JSON 格式无效")}},N=s=>{const a=s.target.files?.[0];if(!a)return;const l=new FileReader;l.onload=v=>{h(v.target?.result)},l.readAsText(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(y,{title:"活跃账号",value:r.active,sub:`总计: ${r.total}`,icon:c.Server,color:"text-blue-500"}),e.jsx(y,{title:"健康状态",value:r.errors===0?"健康":"降级",sub:`检测到 ${r.errors} 个错误`,icon:c.Activity,color:r.errors===0?"text-green-500":"text-orange-500"}),e.jsx(y,{title:"Project IDs",value:n.filter(s=>!!s.project_id).length,sub:"自动探测",icon:c.Shield,color:"text-purple-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:d,title:"刷新",children:e.jsx(c.RotateCcw,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-semibold text-lg",children:"账号列表"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:()=>u(!p),className:"flex items-center gap-2",children:[e.jsx(c.Plus,{className:"w-4 h-4"})," 导入 / 添加"]})})]}),p&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30 space-y-3 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium text-sm",children:"粘贴 JSON 或上传文件"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",accept:".json",ref:g,onChange:N,className:"hidden"}),e.jsxs("button",{onClick:()=>g.current?.click(),className:"flex items-center gap-1 text-xs px-2 py-1 bg-secondary rounded hover:bg-secondary/80",children:[e.jsx(c.Upload,{className:"w-3 h-3"})," 选择文件"]})]})]}),e.jsx("textarea",{className:"w-full h-32 p-2 rounded-md font-mono text-xs bg-background border focus:ring-2 ring-primary/20 outline-none",placeholder:'[{"name": "acc1", "credentials": {...}}]',value:x,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>u(!1),children:"取消"}),e.jsx(o,{size:"sm",onClick:j,children:"保存并覆盖"})]})]}),e.jsx(w,{children:e.jsxs(S,{children:[e.jsx(T,{children:e.jsxs(b,{children:[e.jsx(f,{className:"w-[80px]",children:"状态"}),e.jsx(f,{children:"名称"}),e.jsx(f,{children:"Project ID"}),e.jsx(f,{children:"最后使用"}),e.jsx(f,{className:"text-right",children:"操作"})]})}),e.jsxs(A,{children:[n.map(s=>e.jsxs(b,{className:"group",children:[e.jsx(m,{children:s.is_active?e.jsx(C,{variant:"default",className:"bg-green-500/10 text-green-500 border-green-500/20 hover:bg-green-500/20",children:"活跃"}):e.jsx(C,{variant:"secondary",children:"离线"})}),e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{className:"font-mono text-xs text-muted-foreground",children:s.project_id||"等待中..."}),e.jsx(m,{className:"text-xs text-muted-foreground",children:s.last_used_at?new Date(s.last_used_at).toLocaleTimeString():"-"}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>alert("暂未实现编辑功能"),children:e.jsx(c.Edit2,{className:"w-3.5 h-3.5"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>{if(confirm(`确认删除账号 ${s.name}?`)){const a=n.filter(l=>l.id!==s.id);t(a)}},children:e.jsx(c.Trash2,{className:"w-3.5 h-3.5"})})]})})]},s.id)),n.length===0&&e.jsx(b,{children:e.jsx(m,{colSpan:5,className:"h-32 text-center text-muted-foreground",children:"暂无配置账号"})})]})]})})]})};function I({locale:n}){const[t,d]=i.useState("accounts"),[x,h]=i.useState([]),[p,u]=i.useState([]),[g,r]=i.useState(!1);i.useEffect(()=>{const s=async()=>{try{const l=await fetch("/api/v1/gateway/gemini-cli/logs");if(l.ok){const v=await l.json();u(v)}}catch{}};s();const a=setInterval(s,2e3);return()=>clearInterval(a)},[]);const j=async()=>{try{r(!0);const s=await fetch("/api/v1/gateway/gemini-cli/accounts");s.ok&&h(await s.json())}finally{r(!1)}};i.useEffect(()=>{j()},[]);const N=async s=>{try{r(!0);const a=await fetch("/api/v1/gateway/gemini-cli/accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok)await j();else{const l=await a.json();alert("操作失败: "+l.error)}}catch{alert("网络错误")}finally{r(!1)}};return e.jsxs("div",{className:"w-full h-full p-6 space-y-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between pb-6 border-b",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gemini CLI 管理器"}),e.jsx("p",{className:"text-muted-foreground",children:"管理多账号轮询与内部 API 网关设置。"})]}),e.jsxs("div",{className:"flex bg-muted/50 p-1 rounded-full border",children:[e.jsx(o,{variant:t==="accounts"?"default":"ghost",onClick:()=>d("accounts"),className:"rounded-full shadow-none",children:"账号管理"}),e.jsx(o,{variant:t==="logs"?"default":"ghost",onClick:()=>d("logs"),className:"rounded-full shadow-none",children:"实时日志"})]})]}),e.jsx("div",{className:g?"opacity-50 pointer-events-none transition-opacity":"",children:t==="accounts"?e.jsx(_,{accounts:x,onUpdate:N,onRefresh:j}):e.jsx("div",{className:"h-[600px]",children:e.jsx(z,{logs:p})})})]})}exports.default=I;
