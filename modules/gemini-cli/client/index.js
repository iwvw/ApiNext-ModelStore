"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("react/jsx-runtime"),i=require("react"),n=require("lucide-react"),g=({title:r,value:t,sub:o,icon:d,color:x="text-primary"})=>d?e.jsxs("div",{className:"p-4 rounded-xl border bg-card text-card-foreground shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg bg-muted ${x}`,children:e.jsx(d,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r}),e.jsx("h3",{className:"text-2xl font-bold",children:t}),o&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o})]})]}):null,N=({logs:r})=>e.jsxs("div",{className:"flex flex-col h-full overflow-hidden bg-zinc-950 text-zinc-300 font-mono text-sm rounded-lg border border-zinc-800",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-zinc-800 bg-zinc-900",children:[e.jsxs("span",{className:"font-semibold flex items-center gap-2",children:[e.jsx(n.Terminal,{className:"w-4 h-4"})," 实时日志"]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:[r.length," events"]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:[r.map(t=>e.jsxs("div",{className:"group flex gap-3 hover:bg-zinc-900/50 p-1 -mx-1 rounded",children:[e.jsx("span",{className:"text-zinc-600 shrink-0",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${t.status===200?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:t.status===200?"OK":"ERR"}),e.jsx("span",{className:"text-zinc-400",children:t.model}),e.jsxs("span",{className:"text-zinc-500 text-xs",children:["via ",t.account]})]}),t.has_thinking&&e.jsxs("div",{className:"text-purple-400 text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-3 bg-purple-500 rounded-full inline-block"}),"捕捉到思考过程"]}),t.error&&e.jsx("div",{className:"text-red-400 break-all",children:t.error})]}),e.jsxs("span",{className:"text-zinc-500 shrink-0",children:[t.duration,"ms"]})]},t.id)),r.length===0&&e.jsx("div",{className:"text-zinc-600 text-center py-10 italic",children:"等待请求中..."})]})]}),b=({accounts:r,onUpdate:t,onRefresh:o})=>{const[d,x]=i.useState(""),[h,m]=i.useState(!1),p=i.useRef(null),l={total:r.length,active:r.filter(s=>s.is_active).length,errors:r.reduce((s,a)=>s+(a.error_count||0),0)},u=()=>{try{const s=JSON.parse(d);let a=s;!Array.isArray(s)&&s.accounts&&Array.isArray(s.accounts)&&(a=s.accounts),Array.isArray(a)?(t(a),m(!1),x("")):alert("格式错误：必须是账号数组，或包含 accounts 数组的对象。")}catch{alert("JSON 格式无效")}},f=s=>{const a=s.target.files?.[0];if(!a)return;const c=new FileReader;c.onload=j=>{x(j.target?.result)},c.readAsText(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(g,{title:"活跃账号",value:l.active,sub:`总计: ${l.total}`,icon:n.Server,color:"text-blue-500"}),e.jsx(g,{title:"健康状态",value:l.errors===0?"健康":"降级",sub:`检测到 ${l.errors} 个错误`,icon:n.Activity,color:l.errors===0?"text-green-500":"text-orange-500"}),e.jsx(g,{title:"Project IDs",value:r.filter(s=>!!s.project_id).length,sub:"自动探测",icon:n.Shield,color:"text-purple-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-muted rounded-md transition-colors",title:"刷新",children:e.jsx(n.RotateCcw,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-semibold text-lg",children:"账号列表"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>m(!h),className:"flex items-center gap-2 px-3 py-1.5 bg-primary text-primary-foreground text-sm rounded-md shadow hover:bg-primary/90 transition-colors",children:[e.jsx(n.Plus,{className:"w-4 h-4"})," 导入 / 添加"]})})]}),h&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30 space-y-3 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium text-sm",children:"粘贴 JSON 或上传文件"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",accept:".json",ref:p,onChange:f,className:"hidden"}),e.jsxs("button",{onClick:()=>p.current?.click(),className:"flex items-center gap-1 text-xs px-2 py-1 bg-secondary rounded hover:bg-secondary/80",children:[e.jsx(n.Upload,{className:"w-3 h-3"})," 选择文件"]})]})]}),e.jsx("textarea",{className:"w-full h-32 p-2 rounded-md font-mono text-xs bg-background border focus:ring-2 ring-primary/20 outline-none",placeholder:'[{"name": "acc1", "credentials": {...}}]',value:d,onChange:s=>x(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-3 py-1 text-sm bg-background border rounded hover:bg-muted",children:"取消"}),e.jsx("button",{onClick:u,className:"px-3 py-1 bg-primary text-primary-foreground text-sm rounded shadow hover:bg-primary/90",children:"保存并覆盖"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 border-b",children:e.jsxs("tr",{className:"text-left text-muted-foreground",children:[e.jsx("th",{className:"p-3 font-medium",children:"状态"}),e.jsx("th",{className:"p-3 font-medium",children:"名称"}),e.jsx("th",{className:"p-3 font-medium",children:"Project ID"}),e.jsx("th",{className:"p-3 font-medium",children:"最后使用"}),e.jsx("th",{className:"p-3 font-medium text-right",children:"操作"})]})}),e.jsxs("tbody",{className:"divide-y",children:[r.map(s=>e.jsxs("tr",{className:"hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"p-3",children:s.is_active?e.jsx(n.CheckCircle,{className:"w-4 h-4 text-green-500"}):e.jsx(n.XCircle,{className:"w-4 h-4 text-zinc-400"})}),e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 font-mono text-xs text-muted-foreground",children:s.project_id||"等待中..."}),e.jsx("td",{className:"p-3 text-xs text-muted-foreground",children:s.last_used_at?new Date(s.last_used_at).toLocaleTimeString():"-"}),e.jsxs("td",{className:"p-3 text-right flex justify-end gap-2 text-muted-foreground",children:[e.jsx("button",{type:"button",title:"编辑",className:"hover:text-primary p-1 cursor-pointer",onClick:()=>alert("暂未实现编辑功能"),children:e.jsx(n.Edit2,{className:"w-3.5 h-3.5"})}),e.jsx("button",{type:"button",title:"删除",className:"hover:text-destructive p-1 cursor-pointer",onClick:()=>{if(confirm(`确认删除账号 ${s.name}?`)){const a=r.filter(c=>c.id!==s.id);t(a)}},children:e.jsx(n.Trash2,{className:"w-3.5 h-3.5"})})]})]},s.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-muted-foreground",children:"暂无配置账号"})})]})]})})]})};function v({locale:r}){const[t,o]=i.useState("accounts"),[d,x]=i.useState([]),[h,m]=i.useState([]),[p,l]=i.useState(!1);i.useEffect(()=>{const s=async()=>{try{const c=await fetch("/api/v1/gateway/gemini-cli/logs");if(c.ok){const j=await c.json();m(j)}}catch{}};s();const a=setInterval(s,2e3);return()=>clearInterval(a)},[]);const u=async()=>{try{l(!0);const s=await fetch("/api/v1/gateway/gemini-cli/accounts");s.ok&&x(await s.json())}finally{l(!1)}};i.useEffect(()=>{u()},[]);const f=async s=>{try{l(!0);const a=await fetch("/api/v1/gateway/gemini-cli/accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok)await u();else{const c=await a.json();alert("操作失败: "+c.error)}}catch{alert("网络错误")}finally{l(!1)}};return e.jsxs("div",{className:"w-full h-full p-6 space-y-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between pb-6 border-b",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gemini CLI 管理器"}),e.jsx("p",{className:"text-muted-foreground",children:"管理多账号轮询与内部 API 网关设置。"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o("accounts"),className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${t==="accounts"?"bg-primary text-primary-foreground shadow":"hover:bg-muted"}`,children:"账号管理"}),e.jsx("button",{onClick:()=>o("logs"),className:`px-4 py-2 rounded-full text-sm font-medium transition-all ${t==="logs"?"bg-primary text-primary-foreground shadow":"hover:bg-muted"}`,children:"实时日志"})]})]}),e.jsx("div",{className:p?"opacity-50 pointer-events-none transition-opacity":"",children:t==="accounts"?e.jsx(b,{accounts:d,onUpdate:f,onRefresh:u}):e.jsx("div",{className:"h-[600px]",children:e.jsx(N,{logs:h})})})]})}exports.default=v;
